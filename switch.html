<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Control Panel - GitHub Auto Update</title>
  <style>
    /* [Your same CSS code unchanged, skipped for brevity] */
    /* ... */
  </style>
</head>
<body>
  <div class="container">
    <h1>GitHub Landing Page Control</h1>
    <p class="subtitle">Control your pages by auto-updating GitHub</p>

    <div class="success-message" id="successMessage"></div>
    <div class="error-message" id="errorMessage"></div>

    <div class="token-warning">
      ⚠️ <strong>ADD YOUR TOKEN:</strong> Edit line ~293 and replace <code>'ADD_YOUR_GITHUB_TOKEN_HERE'</code> with your actual GitHub token
    </div>

    <div class="control-box">
      <div class="add-page-box">
        <div class="add-page-title">Add New Page to Control</div>
        <div class="add-page-form">
          <input type="text" class="add-input" id="newPagePath" placeholder="Enter path (e.g., ain, change, donima)" />
          <button class="add-btn" onclick="addPage()">Add Page</button>
        </div>
      </div>

      <div class="pages-list" id="pagesList">
        <div class="empty-state">Waiting for GitHub token...</div>
      </div>
    </div>
  </div>

  <script>
    // CONFIGURATION - Replace the token!
    const config = {
      username: 'ddgoncalves27',
      repo: 'teste',
      token: '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', // ← token injected here
      branch: 'main'
    };

    let disabledPages = [];

    async function connectToGitHub() {
      showMessage('Connecting to GitHub...', 'success');

      if (config.token === 'ADD_YOUR_GITHUB_TOKEN_HERE') {
        showError('Please add your GitHub token on line 293!');
        document.getElementById('pagesList').innerHTML = '<div class="empty-state">⚠️ Add your GitHub token to line 293 of this file</div>';
        return;
      }

      try {
        const response = await fetch(
          `https://api.github.com/repos/${config.username}/${config.repo}/contents/index.html?ref=${config.branch}`,
          {
            headers: {
              'Authorization': `token ${config.token}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          }
        );

        if (!response.ok) {
          if (response.status === 401) {
            throw new Error('Invalid token. Please check your GitHub token.');
          } else if (response.status === 404) {
            throw new Error('Repository or file not found. Check username/repo.');
          }
          throw new Error('Failed to connect to GitHub.');
        }

        const data = await response.json();
        const content = atob(data.content);
        const match = content.match(/const DISABLED_PAGES = \[([\s\S]*?)\];/);
        if (match) {
          const arrayContent = match[1];
          const pages = arrayContent.match(/'([^']+)'/g) || [];
          disabledPages = pages.map(p => p.replace(/'/g, ''));
        }

        showMessage('Connected to GitHub successfully!', 'success');
        document.querySelector('.token-warning').style.display = 'none';
        updatePagesList();

      } catch (error) {
        showError(error.message);
        document.getElementById('pagesList').innerHTML = `<div class="empty-state">❌ ${error.message}</div>`;
      }
    }

    function updatePagesList() {
      const pagesList = document.getElementById('pagesList');

      if (disabledPages.length === 0) {
        pagesList.innerHTML = '<div class="empty-state">No disabled pages yet. Add a page path above to disable it!</div>';
        return;
      }

      pagesList.innerHTML = '';

      disabledPages.forEach(path => {
        const pageItem = createPageItem(path, false);
        pagesList.appendChild(pageItem);
      });
    }

    function createPageItem(path, isActive) {
      const div = document.createElement('div');
      div.className = 'page-item';
      div.innerHTML = `
        <div class="page-info">
          <div class="page-path">/${path}</div>
          <div class="page-status ${isActive ? 'active' : 'inactive'}">${isActive ? 'ACTIVE' : 'INACTIVE'}</div>
        </div>
        <div style="display: flex; align-items: center;">
          <label class="toggle-switch">
            <input type="checkbox" ${isActive ? 'checked' : ''} onchange="togglePage('${path}', this.checked)">
            <span class="toggle-slider"></span>
          </label>
          <button class="delete-btn" onclick="deletePage('${path}')">Delete</button>
        </div>
      `;
      return div;
    }

    async function updateGitHubFile() {
      showMessage('Updating GitHub...', 'success');

      try {
        const getResponse = await fetch(
          `https://api.github.com/repos/${config.username}/${config.repo}/contents/index.html?ref=${config.branch}`,
          {
            headers: {
              'Authorization': `token ${config.token}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          }
        );

        if (!getResponse.ok) {
          throw new Error('Failed to get current file');
        }

        const getData = await getResponse.json();
        const content = atob(getData.content);

        const newArray = disabledPages.length > 0 
          ? disabledPages.map(p => `'${p}'`).join(',\n            ')
          : '';
        const newArrayString = `const DISABLED_PAGES = [\n            ${newArray}\n        ];`;

        const newContent = content.replace(
          /const DISABLED_PAGES = \[([\s\S]*?)\];/,
          newArrayString
        );

        const updateResponse = await fetch(
          `https://api.github.com/repos/${config.username}/${config.repo}/contents/index.html`,
          {
            method: 'PUT',
            headers: {
              'Authorization': `token ${config.token}`,
              'Accept': 'application/vnd.github.v3+json',
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              message: `Update disabled pages: ${disabledPages.join(', ') || 'none'}`,
              content: btoa(newContent),
              sha: getData.sha,
              branch: config.branch
            })
          }
        );

        if (!updateResponse.ok) {
          const errorData = await updateResponse.json();
          throw new Error(errorData.message || 'Failed to update file');
        }

        showMessage('✅ Updated successfully! Changes will be live in 1-2 minutes.', 'success');

      } catch (error) {
        showError('Failed to update: ' + error.message);
      }
    }

    async function addPage() {
      const input = document.getElementById('newPagePath');
      const path = input.value.trim().replace(/^\//, '').toLowerCase();

      if (!path) {
        showError('Please enter a page path');
        return;
      }

      if (disabledPages.includes(path)) {
        showError('Page already exists in disabled list');
        return;
      }

      disabledPages.push(path);
      input.value = '';

      updatePagesList();
      await updateGitHubFile();
    }

    async function togglePage(path, isActive) {
      if (isActive) {
        disabledPages = disabledPages.filter(p => p !== path);
      } else {
        if (!disabledPages.includes(path)) {
          disabledPages.push(path);
        }
      }

      updatePagesList();
      await updateGitHubFile();
    }

    async function deletePage(path) {
      if (!confirm(`Remove "${path}" from control? The page will be enabled again.`)) {
        return;
      }

      disabledPages = disabledPages.filter(p => p !== path);
      updatePagesList();
      await updateGitHubFile();
    }

    function showMessage(message, type) {
      const successEl = document.getElementById('successMessage');
      const errorEl = document.getElementById('errorMessage');

      if (type === 'success') {
        successEl.textContent = message;
        successEl.style.display = 'block';
        errorEl.style.display = 'none';
        setTimeout(() => {
          successEl.style.display = 'none';
        }, 5000);
      }
    }

    function showError(message) {
      const errorEl = document.getElementById('errorMessage');
      const successEl = document.getElementById('successMessage');

      errorEl.textContent = message;
      errorEl.style.display = 'block';
      successEl.style.display = 'none';
      setTimeout(() => {
        errorEl.style.display = 'none';
      }, 5000);
    }

    document.addEventListener('DOMContentLoaded', function () {
      setTimeout(connectToGitHub, 500);
    });

    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('newPagePath').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          addPage();
        }
      });
    });
  </script>
</body>
</html>
